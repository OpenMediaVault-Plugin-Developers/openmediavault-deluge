#!/bin/bash

set -e

. /etc/default/openmediavault
. /usr/share/openmediavault/scripts/helper-functions

export PATH=$PATH:/usr/local/sbin/
export PATH=$PATH:/usr/sbin/
export PATH=$PATH:/sbin

install() {
# Need to get compatable versions of libtorrent-rasterbar and python-libtorrent
# I have compiled these deb packages and uploaded them for use until a better method is found
cd /tmp
wget http://jamied.pwp.blueyonder.co.uk/libtorrent-rasterbar7_0.16.17-1ubuntu3~ppa1~precise_amd64.deb
wget http://jamied.pwp.blueyonder.co.uk/python-libtorrent_0.16.17-1ubuntu3~ppa1~precise_amd64.deb

/usr/bin/dpkg -i /tmp/libtorrent-rasterbar7_0.16.17-1ubuntu3~ppa1~precise_amd64.deb
/usr/bin/dpkg -i /tmp/python-libtorrent_0.16.17-1ubuntu3~ppa1~precise_amd64.deb

rm /tmp/libtorrent-rasterbar7_0.16.17-1ubuntu3~ppa1~precise_amd64.deb
rm /tmp/python-libtorrent_0.16.17-1ubuntu3~ppa1~precise_amd64.deb
apt-get -y install -t precise deluge-common deluged deluge-web deluge-console


xmlstarlet ed -L -u "//services/deluge/done" -v 1 -n ${OMV_CONFIG_FILE}
}

case "$2" in
  install)
    install
    ;;
  getsettings)
    getsettings
    ;;
  *)
    exit 1
esac
